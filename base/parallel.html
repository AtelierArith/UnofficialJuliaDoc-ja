<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tasks · The Julia Language</title><meta name="title" content="Tasks · The Julia Language"/><meta property="og:title" content="Tasks · The Julia Language"/><meta property="twitter:title" content="Tasks · The Julia Language"/><meta name="description" content="Documentation for The Julia Language."/><meta property="og:description" content="Documentation for The Julia Language."/><meta property="twitter:description" content="Documentation for The Julia Language."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-28835595-6"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-28835595-6', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/julia-manual.css" rel="stylesheet" type="text/css"/><link href="../assets/julia.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="The Julia Language logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="The Julia Language logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Julia Documentation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../manual/getting-started.html">Getting Started</a></li><li><a class="tocitem" href="../manual/installation.html">Installation</a></li><li><a class="tocitem" href="../manual/variables.html">Variables</a></li><li><a class="tocitem" href="../manual/integers-and-floating-point-numbers.html">Integers and Floating-Point Numbers</a></li><li><a class="tocitem" href="../manual/mathematical-operations.html">Mathematical Operations and Elementary Functions</a></li><li><a class="tocitem" href="../manual/complex-and-rational-numbers.html">Complex and Rational Numbers</a></li><li><a class="tocitem" href="../manual/strings.html">Strings</a></li><li><a class="tocitem" href="../manual/functions.html">Functions</a></li><li><a class="tocitem" href="../manual/control-flow.html">Control Flow</a></li><li><a class="tocitem" href="../manual/variables-and-scoping.html">Scope of Variables</a></li><li><a class="tocitem" href="../manual/types.html">Types</a></li><li><a class="tocitem" href="../manual/methods.html">Methods</a></li><li><a class="tocitem" href="../manual/constructors.html">Constructors</a></li><li><a class="tocitem" href="../manual/conversion-and-promotion.html">Conversion and Promotion</a></li><li><a class="tocitem" href="../manual/interfaces.html">Interfaces</a></li><li><a class="tocitem" href="../manual/modules.html">Modules</a></li><li><a class="tocitem" href="../manual/documentation.html">Documentation</a></li><li><a class="tocitem" href="../manual/metaprogramming.html">Metaprogramming</a></li><li><a class="tocitem" href="../manual/arrays.html">Single- and multi-dimensional Arrays</a></li><li><a class="tocitem" href="../manual/missing.html">Missing Values</a></li><li><a class="tocitem" href="../manual/networking-and-streams.html">Networking and Streams</a></li><li><a class="tocitem" href="../manual/parallel-computing.html">Parallel Computing</a></li><li><a class="tocitem" href="../manual/asynchronous-programming.html">Asynchronous Programming</a></li><li><a class="tocitem" href="../manual/multi-threading.html">Multi-Threading</a></li><li><a class="tocitem" href="../manual/distributed-computing.html">Multi-processing and Distributed Computing</a></li><li><a class="tocitem" href="../manual/running-external-programs.html">Running External Programs</a></li><li><a class="tocitem" href="../manual/calling-c-and-fortran-code.html">Calling C and Fortran Code</a></li><li><a class="tocitem" href="../manual/handling-operating-system-variation.html">Handling Operating System Variation</a></li><li><a class="tocitem" href="../manual/environment-variables.html">Environment Variables</a></li><li><a class="tocitem" href="../manual/embedding.html">Embedding Julia</a></li><li><a class="tocitem" href="../manual/code-loading.html">Code Loading</a></li><li><a class="tocitem" href="../manual/profile.html">Profiling</a></li><li><a class="tocitem" href="../manual/stacktraces.html">Stack Traces</a></li><li><a class="tocitem" href="../manual/performance-tips.html">Performance Tips</a></li><li><a class="tocitem" href="../manual/workflow-tips.html">Workflow Tips</a></li><li><a class="tocitem" href="../manual/style-guide.html">Style Guide</a></li><li><a class="tocitem" href="../manual/faq.html">Frequently Asked Questions</a></li><li><a class="tocitem" href="../manual/noteworthy-differences.html">Noteworthy Differences from other Languages</a></li><li><a class="tocitem" href="../manual/unicode-input.html">Unicode Input</a></li><li><a class="tocitem" href="../manual/command-line-interface.html">Command-line Interface</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Base</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="base.html">Essentials</a></li><li><a class="tocitem" href="collections.html">Collections and Data Structures</a></li><li><a class="tocitem" href="math.html">Mathematics</a></li><li><a class="tocitem" href="numbers.html">Numbers</a></li><li><a class="tocitem" href="strings.html">Strings</a></li><li><a class="tocitem" href="arrays.html">Arrays</a></li><li class="is-active"><a class="tocitem" href="parallel.html">Tasks</a><ul class="internal"><li><a class="tocitem" href="#Scheduling"><span>Scheduling</span></a></li><li><a class="tocitem" href="#lib-task-sync"><span>Synchronization</span></a></li><li><a class="tocitem" href="#Channels"><span>Channels</span></a></li><li><a class="tocitem" href="#low-level-schedule-wait"><span>Low-level synchronization using <code>schedule</code> and <code>wait</code></span></a></li></ul></li><li><a class="tocitem" href="multi-threading.html">Multi-Threading</a></li><li><a class="tocitem" href="scopedvalues.html">Scoped Values</a></li><li><a class="tocitem" href="constants.html">Constants</a></li><li><a class="tocitem" href="file.html">Filesystem</a></li><li><a class="tocitem" href="io-network.html">I/O and Network</a></li><li><a class="tocitem" href="punctuation.html">Punctuation</a></li><li><a class="tocitem" href="sort.html">Sorting and Related Functions</a></li><li><a class="tocitem" href="iterators.html">Iteration utilities</a></li><li><a class="tocitem" href="reflection.html">Reflection and introspection</a></li><li><a class="tocitem" href="c.html">C Interface</a></li><li><a class="tocitem" href="libc.html">C Standard Library</a></li><li><a class="tocitem" href="stacktraces.html">StackTraces</a></li><li><a class="tocitem" href="simd-types.html">SIMD Support</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Standard Library</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../stdlib/ArgTools.html">ArgTools</a></li><li><a class="tocitem" href="../stdlib/Artifacts.html">Artifacts</a></li><li><a class="tocitem" href="../stdlib/Base64.html">Base64</a></li><li><a class="tocitem" href="../stdlib/CRC32c.html">CRC32c</a></li><li><a class="tocitem" href="../stdlib/Dates.html">Dates</a></li><li><a class="tocitem" href="../stdlib/DelimitedFiles.html">Delimited Files</a></li><li><a class="tocitem" href="../stdlib/Distributed.html">Distributed Computing</a></li><li><a class="tocitem" href="../stdlib/Downloads.html">Downloads</a></li><li><a class="tocitem" href="../stdlib/FileWatching.html">File Events</a></li><li><a class="tocitem" href="../stdlib/Future.html">Future</a></li><li><a class="tocitem" href="../stdlib/InteractiveUtils.html">Interactive Utilities</a></li><li><a class="tocitem" href="../stdlib/LazyArtifacts.html">Lazy Artifacts</a></li><li><a class="tocitem" href="../stdlib/LibCURL.html">LibCURL</a></li><li><a class="tocitem" href="../stdlib/LibGit2.html">LibGit2</a></li><li><a class="tocitem" href="../stdlib/Libdl.html">Dynamic Linker</a></li><li><a class="tocitem" href="../stdlib/LinearAlgebra.html">Linear Algebra</a></li><li><a class="tocitem" href="../stdlib/Logging.html">Logging</a></li><li><a class="tocitem" href="../stdlib/Markdown.html">Markdown</a></li><li><a class="tocitem" href="../stdlib/Mmap.html">Memory-mapped I/O</a></li><li><a class="tocitem" href="../stdlib/NetworkOptions.html">Network Options</a></li><li><a class="tocitem" href="../stdlib/Pkg.html">Pkg</a></li><li><a class="tocitem" href="../stdlib/Printf.html">Printf</a></li><li><a class="tocitem" href="../stdlib/Profile.html">Profiling</a></li><li><a class="tocitem" href="../stdlib/REPL.html">The Julia REPL</a></li><li><a class="tocitem" href="../stdlib/Random.html">Random Numbers</a></li><li><a class="tocitem" href="../stdlib/SHA.html">SHA</a></li><li><a class="tocitem" href="../stdlib/Serialization.html">Serialization</a></li><li><a class="tocitem" href="../stdlib/SharedArrays.html">Shared Arrays</a></li><li><a class="tocitem" href="../stdlib/Sockets.html">Sockets</a></li><li><a class="tocitem" href="../stdlib/SparseArrays.html">Sparse Arrays</a></li><li><a class="tocitem" href="../stdlib/Statistics.html">Statistics</a></li><li><a class="tocitem" href="../stdlib/StyledStrings.html">StyledStrings</a></li><li><a class="tocitem" href="../stdlib/TOML.html">TOML</a></li><li><a class="tocitem" href="../stdlib/Tar.html">Tar</a></li><li><a class="tocitem" href="../stdlib/Test.html">Unit Testing</a></li><li><a class="tocitem" href="../stdlib/UUIDs.html">UUIDs</a></li><li><a class="tocitem" href="../stdlib/Unicode.html">Unicode</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Documentation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox"/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Documentation of Julia&#39;s Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../devdocs/init.html">Initialization of the Julia runtime</a></li><li><a class="tocitem" href="../devdocs/ast.html">Julia ASTs</a></li><li><a class="tocitem" href="../devdocs/types.html">More about types</a></li><li><a class="tocitem" href="../devdocs/object.html">Memory layout of Julia Objects</a></li><li><a class="tocitem" href="../devdocs/eval.html">Eval of Julia code</a></li><li><a class="tocitem" href="../devdocs/callconv.html">Calling Conventions</a></li><li><a class="tocitem" href="../devdocs/compiler.html">High-level Overview of the Native-Code Generation Process</a></li><li><a class="tocitem" href="../devdocs/functions.html">Julia Functions</a></li><li><a class="tocitem" href="../devdocs/cartesian.html">Base.Cartesian</a></li><li><a class="tocitem" href="../devdocs/meta.html">Talking to the compiler (the <code>:meta</code> mechanism)</a></li><li><a class="tocitem" href="../devdocs/subarrays.html">SubArrays</a></li><li><a class="tocitem" href="../devdocs/isbitsunionarrays.html">isbits Union Optimizations</a></li><li><a class="tocitem" href="../devdocs/sysimg.html">System Image Building</a></li><li><a class="tocitem" href="../devdocs/pkgimg.html">Package Images</a></li><li><a class="tocitem" href="../devdocs/llvm-passes.html">Custom LLVM Passes</a></li><li><a class="tocitem" href="../devdocs/llvm.html">Working with LLVM</a></li><li><a class="tocitem" href="../devdocs/stdio.html">printf() and stdio in the Julia runtime</a></li><li><a class="tocitem" href="../devdocs/boundscheck.html">Bounds checking</a></li><li><a class="tocitem" href="../devdocs/locks.html">Proper maintenance and care of multi-threading locks</a></li><li><a class="tocitem" href="../devdocs/offset-arrays.html">Arrays with custom indices</a></li><li><a class="tocitem" href="../devdocs/require.html">Module loading</a></li><li><a class="tocitem" href="../devdocs/inference.html">Inference</a></li><li><a class="tocitem" href="../devdocs/ssair.html">Julia SSA-form IR</a></li><li><a class="tocitem" href="../devdocs/EscapeAnalysis.html"><code>EscapeAnalysis</code></a></li><li><a class="tocitem" href="../devdocs/aot.html">Ahead of Time Compilation</a></li><li><a class="tocitem" href="../devdocs/gc-sa.html">Static analyzer annotations for GC correctness in C code</a></li><li><a class="tocitem" href="../devdocs/gc.html">Garbage Collection in Julia</a></li><li><a class="tocitem" href="../devdocs/jit.html">JIT Design and Implementation</a></li><li><a class="tocitem" href="../devdocs/builtins.html">Core.Builtins</a></li><li><a class="tocitem" href="../devdocs/precompile_hang.html">Fixing precompilation hangs due to open tasks or IO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Developing/debugging Julia&#39;s C code</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../devdocs/backtraces.html">Reporting and analyzing crashes (segfaults)</a></li><li><a class="tocitem" href="../devdocs/debuggingtips.html">gdb debugging tips</a></li><li><a class="tocitem" href="../devdocs/valgrind.html">Using Valgrind with Julia</a></li><li><a class="tocitem" href="../devdocs/external_profilers.html">External Profiler Support</a></li><li><a class="tocitem" href="../devdocs/sanitizers.html">Sanitizer support</a></li><li><a class="tocitem" href="../devdocs/probes.html">Instrumenting Julia with DTrace, and bpftrace</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Building Julia</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../devdocs/build/build.html">Building Julia (Detailed)</a></li><li><a class="tocitem" href="../devdocs/build/linux.html">Linux</a></li><li><a class="tocitem" href="../devdocs/build/macos.html">macOS</a></li><li><a class="tocitem" href="../devdocs/build/windows.html">Windows</a></li><li><a class="tocitem" href="../devdocs/build/freebsd.html">FreeBSD</a></li><li><a class="tocitem" href="../devdocs/build/arm.html">ARM (Linux)</a></li><li><a class="tocitem" href="../devdocs/build/distributing.html">Binary distributions</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Base</a></li><li class="is-active"><a href="parallel.html">Tasks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="parallel.html">Tasks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia/blob/master/doc/src/base/parallel.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Tasks"><a class="docs-heading-anchor" href="#Tasks">Tasks</a><a id="Tasks-1"></a><a class="docs-heading-anchor-permalink" href="#Tasks" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Core.Task" href="#Core.Task"><code>Core.Task</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Task(func)</code></pre><p>指定された関数 <code>func</code>（引数なしで呼び出せる必要があります）を実行する <code>Task</code>（すなわちコルーチン）を作成します。この関数が戻ると、タスクは終了します。タスクは、<a href="parallel.html#Base.schedule"><code>schedule</code></a>d で構築時の親からの「ワールドエイジ」で実行されます。</p><div class="admonition is-warning" id="Warning-672423dccd174cf5"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-672423dccd174cf5" title="Permalink"></a></header><div class="admonition-body"><p>デフォルトでは、タスクにはスティッキービットが true <code>t.sticky</code> に設定されます。これは、<a href="parallel.html#Base.@async"><code>@async</code></a> の歴史的なデフォルトをモデル化しています。スティッキーなタスクは、最初にスケジュールされたワーカースレッドでのみ実行でき、スケジュールされると、スケジュール元のタスクもスティッキーになります。<a href="multi-threading.html#Base.Threads.@spawn"><code>Threads.@spawn</code></a> の動作を得るには、スティッキービットを手動で <code>false</code> に設定してください。</p></div></div><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a() = sum(i for i in 1:1000);

julia&gt; b = Task(a);</code></pre><p>この例では、<code>b</code> はまだ開始されていない実行可能な <code>Task</code> です。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/docs/basedocs.jl#L1786-L1808">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.@task" href="#Base.@task"><code>Base.@task</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@task</code></pre><p>式を<a href="parallel.html#Core.Task"><code>Task</code></a>でラップし、実行せずに<a href="parallel.html#Core.Task"><code>Task</code></a>を返します。これはタスクを作成するだけで、実行はしません。</p><div class="admonition is-warning" id="Warning-a623ac7f2fcb7fa8"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-a623ac7f2fcb7fa8" title="Permalink"></a></header><div class="admonition-body"><p>デフォルトでは、タスクにはスティッキービットがtrue <code>t.sticky</code>に設定されます。これは<a href="parallel.html#Base.@async"><code>@async</code></a>の歴史的なデフォルトをモデル化しています。スティッキーなタスクは、最初にスケジュールされたワーカースレッドでのみ実行でき、スケジュールされると、そこからスケジュールされたタスクもスティッキーになります。<a href="multi-threading.html#Base.Threads.@spawn"><code>Threads.@spawn</code></a>の動作を得るには、スティッキービットを手動で<code>false</code>に設定してください。</p></div></div><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a1() = sum(i for i in 1:1000);

julia&gt; b = @task a1();

julia&gt; istaskstarted(b)
false

julia&gt; schedule(b);

julia&gt; yield();

julia&gt; istaskdone(b)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L112-L141">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.@async" href="#Base.@async"><code>Base.@async</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@async</code></pre><p>式を <a href="parallel.html#Core.Task"><code>Task</code></a> でラップし、ローカルマシンのスケジューラーキューに追加します。</p><p>値は <code>$</code> を介して <code>@async</code> に補間でき、これは値を構築された基盤のクロージャに直接コピーします。これにより、変数の<em>値</em>を挿入でき、非同期コードを現在のタスクにおける変数の値の変更から隔離できます。</p><div class="admonition is-warning" id="Warning-8f38241b11b235c6"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-8f38241b11b235c6" title="Permalink"></a></header><div class="admonition-body"><p>公開されているライブラリでは、<strong>並列性が必要ない場合でも</strong>常に <code>@async</code> よりも <code>Threads.@spawn</code> を優先することを強く推奨します。これは、<code>@async</code> の使用が現在のJuliaの実装において<em>親</em>タスクのワーカースレッド間の移行を無効にするためです。したがって、ライブラリ関数内での <code>@async</code> の見かけ上無害な使用は、ユーザーアプリケーションの非常に異なる部分のパフォーマンスに大きな影響を与える可能性があります。</p></div></div><div class="admonition is-compat" id="Julia-1.4-473accb7e43d408e"><header class="admonition-header">Julia 1.4<a class="admonition-anchor" href="#Julia-1.4-473accb7e43d408e" title="Permalink"></a></header><div class="admonition-body"><p><code>$</code> を介して値を補間することは、Julia 1.4以降で利用可能です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L507-L526">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.asyncmap" href="#Base.asyncmap"><code>Base.asyncmap</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">asyncmap(f, c...; ntasks=0, batch_size=nothing)</code></pre><p>複数の同時タスクを使用して、コレクション（または複数の同じ長さのコレクション）に対して <code>f</code> をマッピングします。複数のコレクション引数がある場合、<code>f</code> は要素ごとに適用されます。</p><p><code>ntasks</code> は同時に実行するタスクの数を指定します。コレクションの長さに応じて、<code>ntasks</code> が指定されていない場合、最大100のタスクが同時マッピングに使用されます。</p><p><code>ntasks</code> はゼロ引数関数としても指定できます。この場合、各要素を処理する前に並行して実行するタスクの数がチェックされ、<code>ntasks_func</code> の値が現在のタスク数を超えている場合に新しいタスクが開始されます。</p><p><code>batch_size</code> が指定されている場合、コレクションはバッチモードで処理されます。この場合、<code>f</code> は引数タプルの <code>Vector</code> を受け入れ、結果のベクターを返す関数でなければなりません。入力ベクターの長さは <code>batch_size</code> 以下になります。</p><p>以下の例は、マッピング関数が実行されるタスクの <code>objectid</code> を返すことで、異なるタスクでの実行を強調しています。</p><p>まず、<code>ntasks</code> が未定義の場合、各要素は異なるタスクで処理されます。</p><pre><code class="nohighlight hljs">julia&gt; tskoid() = objectid(current_task());

julia&gt; asyncmap(x-&gt;tskoid(), 1:5)
5-element Array{UInt64,1}:
 0x6e15e66c75c75853
 0x440f8819a1baa682
 0x9fb3eeadd0c83985
 0xebd3e35fe90d4050
 0x29efc93edce2b961

julia&gt; length(unique(asyncmap(x-&gt;tskoid(), 1:5)))
5</code></pre><p><code>ntasks=2</code> の場合、すべての要素は2つのタスクで処理されます。</p><pre><code class="nohighlight hljs">julia&gt; asyncmap(x-&gt;tskoid(), 1:5; ntasks=2)
5-element Array{UInt64,1}:
 0x027ab1680df7ae94
 0xa23d2f80cd7cf157
 0x027ab1680df7ae94
 0xa23d2f80cd7cf157
 0x027ab1680df7ae94

julia&gt; length(unique(asyncmap(x-&gt;tskoid(), 1:5; ntasks=2)))
2</code></pre><p><code>batch_size</code> が定義されている場合、マッピング関数は引数タプルの配列を受け入れ、結果の配列を返すように変更する必要があります。これを達成するために、修正されたマッピング関数では <code>map</code> が使用されます。</p><pre><code class="nohighlight hljs">julia&gt; batch_func(input) = map(x-&gt;string(&quot;args_tuple: &quot;, x, &quot;, element_val: &quot;, x[1], &quot;, task: &quot;, tskoid()), input)
batch_func (generic function with 1 method)

julia&gt; asyncmap(batch_func, 1:5; ntasks=2, batch_size=2)
5-element Array{String,1}:
 &quot;args_tuple: (1,), element_val: 1, task: 9118321258196414413&quot;
 &quot;args_tuple: (2,), element_val: 2, task: 4904288162898683522&quot;
 &quot;args_tuple: (3,), element_val: 3, task: 9118321258196414413&quot;
 &quot;args_tuple: (4,), element_val: 4, task: 4904288162898683522&quot;
 &quot;args_tuple: (5,), element_val: 5, task: 9118321258196414413&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/asyncmap.jl#L5-L73">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.asyncmap!" href="#Base.asyncmap!"><code>Base.asyncmap!</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">asyncmap!(f, results, c...; ntasks=0, batch_size=nothing)</code></pre><p><a href="parallel.html#Base.asyncmap"><code>asyncmap</code></a>と同様ですが、コレクションを返すのではなく、<code>results</code>に出力を格納します。</p><div class="admonition is-warning" id="Warning-cb47bbe11ce4bc7d"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-cb47bbe11ce4bc7d" title="Permalink"></a></header><div class="admonition-body"><p>変更された引数が他の引数とメモリを共有している場合、動作が予期しないものになることがあります。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/asyncmap.jl#L392-L399">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.current_task" href="#Base.current_task"><code>Base.current_task</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">current_task()</code></pre><p>現在実行中の<a href="parallel.html#Core.Task"><code>Task</code></a>を取得します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L147-L151">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.istaskdone" href="#Base.istaskdone"><code>Base.istaskdone</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">istaskdone(t::Task) -&gt; Bool</code></pre><p>タスクが終了したかどうかを判断します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a2() = sum(i for i in 1:1000);

julia&gt; b = Task(a2);

julia&gt; istaskdone(b)
false

julia&gt; schedule(b);

julia&gt; yield();

julia&gt; istaskdone(b)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L204-L225">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.istaskstarted" href="#Base.istaskstarted"><code>Base.istaskstarted</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">istaskstarted(t::Task) -&gt; Bool</code></pre><p>タスクが実行を開始したかどうかを判断します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a3() = sum(i for i in 1:1000);

julia&gt; b = Task(a3);

julia&gt; istaskstarted(b)
false</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L228-L242">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.istaskfailed" href="#Base.istaskfailed"><code>Base.istaskfailed</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">istaskfailed(t::Task) -&gt; Bool</code></pre><p>タスクが例外によって終了したかどうかを判断します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a4() = error(&quot;task failed&quot;);

julia&gt; b = Task(a4);

julia&gt; istaskfailed(b)
false

julia&gt; schedule(b);

julia&gt; yield();

julia&gt; istaskfailed(b)
true</code></pre><div class="admonition is-compat" id="Julia-1.3-6937285c9726a1de"><header class="admonition-header">Julia 1.3<a class="admonition-anchor" href="#Julia-1.3-6937285c9726a1de" title="Permalink"></a></header><div class="admonition-body"><p>この関数は少なくともJulia 1.3が必要です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L245-L269">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.task_local_storage-Tuple{Any}" href="#Base.task_local_storage-Tuple{Any}"><code>Base.task_local_storage</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">task_local_storage(key)</code></pre><p>現在のタスクのタスクローカルストレージ内のキーの値を取得します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L288-L292">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.task_local_storage-Tuple{Any, Any}" href="#Base.task_local_storage-Tuple{Any, Any}"><code>Base.task_local_storage</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">task_local_storage(key, value)</code></pre><p>現在のタスクのタスクローカルストレージにキーに値を割り当てます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L295-L299">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.task_local_storage-Tuple{Function, Any, Any}" href="#Base.task_local_storage-Tuple{Function, Any, Any}"><code>Base.task_local_storage</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">task_local_storage(body, key, value)</code></pre><p><code>body</code> 関数を修正されたタスクローカルストレージで呼び出します。このストレージでは <code>value</code> が <code>key</code> に割り当てられ、<code>key</code> の以前の値、またはそれが存在しない場合はその状態がその後に復元されます。動的スコープをエミュレートするのに便利です。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L302-L308">source</a></section></article><h2 id="Scheduling"><a class="docs-heading-anchor" href="#Scheduling">Scheduling</a><a id="Scheduling-1"></a><a class="docs-heading-anchor-permalink" href="#Scheduling" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.yield" href="#Base.yield"><code>Base.yield</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">yield()</code></pre><p>スケジューラに切り替えて、他のスケジュールされたタスクが実行されることを許可します。この関数を呼び出すタスクはまだ実行可能であり、他に実行可能なタスクがない場合はすぐに再起動されます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L891-L897">source</a></section><section><div><pre><code class="language-julia hljs">yield(t::Task, arg = nothing)</code></pre><p><code>t</code>に即座に制御を渡す、スケジューラを呼び出す前に<code>schedule(t, arg); yield()</code>を実行する高速で不公平なスケジューリングバージョンです。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L911-L916">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.yieldto" href="#Base.yieldto"><code>Base.yieldto</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">yieldto(t::Task, arg = nothing)</code></pre><p>指定されたタスクに切り替えます。タスクに初めて切り替えたとき、タスクの関数は引数なしで呼び出されます。以降の切り替えでは、<code>arg</code>はタスクの最後の<code>yieldto</code>呼び出しから返されます。これは低レベルの呼び出しであり、タスクの切り替えのみを行い、状態やスケジューリングを考慮しません。その使用は推奨されません。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L925-L932">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.sleep" href="#Base.sleep"><code>Base.sleep</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">sleep(seconds)</code></pre><p>現在のタスクを指定された秒数だけブロックします。最小スリープ時間は1ミリ秒または<code>0.001</code>の入力です。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/asyncevent.jl#L264-L269">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.schedule" href="#Base.schedule"><code>Base.schedule</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">schedule(t::Task, [val]; error=false)</code></pre><p>スケジューラのキューに <a href="parallel.html#Core.Task"><code>Task</code></a> を追加します。これにより、タスクはシステムがアイドル状態のときに常に実行されますが、タスクが <a href="parallel.html#Base.wait"><code>wait</code></a> のようなブロッキング操作を行う場合は除きます。</p><p>第二引数 <code>val</code> が提供されると、タスクが再び実行されるときに（<a href="parallel.html#Base.yieldto"><code>yieldto</code></a> の戻り値を介して）タスクに渡されます。<code>error</code> が <code>true</code> の場合、値は起こされたタスクで例外として発生します。</p><div class="admonition is-warning" id="Warning-d13faff662ccb12d"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-d13faff662ccb12d" title="Permalink"></a></header><div class="admonition-body"><p>開始された任意の <code>Task</code> に対して <code>schedule</code> を使用するのは不正です。詳細については <a href="parallel.html#low-level-schedule-wait">the API reference</a> を参照してください。</p></div></div><div class="admonition is-warning" id="Warning-403f86981152b4c"><header class="admonition-header">Warning<a class="admonition-anchor" href="#Warning-403f86981152b4c" title="Permalink"></a></header><div class="admonition-body"><p>デフォルトでは、タスクには sticky ビットが true <code>t.sticky</code> に設定されます。これは <a href="parallel.html#Base.@async"><code>@async</code></a> の歴史的なデフォルトをモデル化しています。Sticky タスクは、最初にスケジュールされたワーカースレッドでのみ実行でき、スケジュールされると、スケジュール元のタスクも sticky になります。 <a href="multi-threading.html#Base.Threads.@spawn"><code>Threads.@spawn</code></a> の動作を得るには、sticky ビットを手動で <code>false</code> に設定してください。</p></div></div><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; a5() = sum(i for i in 1:1000);

julia&gt; b = Task(a5);

julia&gt; istaskstarted(b)
false

julia&gt; schedule(b);

julia&gt; yield();

julia&gt; istaskstarted(b)
true

julia&gt; istaskdone(b)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L835-L875">source</a></section></article><h2 id="lib-task-sync"><a class="docs-heading-anchor" href="#lib-task-sync">Synchronization</a><a id="lib-task-sync-1"></a><a class="docs-heading-anchor-permalink" href="#lib-task-sync" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.errormonitor" href="#Base.errormonitor"><code>Base.errormonitor</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">errormonitor(t::Task)</code></pre><p>タスク <code>t</code> が失敗した場合、<code>stderr</code> にエラーログを出力します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; Base._wait(errormonitor(Threads.@spawn error(&quot;task failed&quot;)))
Unhandled Task ERROR: task failed
Stacktrace:
[...]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L579-L591">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.@sync" href="#Base.@sync"><code>Base.@sync</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@sync</code></pre><p>すべての字句的に囲まれた <a href="parallel.html#Base.@async"><code>@async</code></a>、<a href="multi-threading.html#Base.Threads.@spawn"><code>@spawn</code></a>、<code>Distributed.@spawnat</code> および <code>Distributed.@distributed</code> の使用が完了するまで待機します。囲まれた非同期操作によってスローされたすべての例外は収集され、<a href="base.html#Base.CompositeException"><code>CompositeException</code></a> としてスローされます。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; Threads.nthreads()
4

julia&gt; @sync begin
           Threads.@spawn println(&quot;Thread-id $(Threads.threadid()), task 1&quot;)
           Threads.@spawn println(&quot;Thread-id $(Threads.threadid()), task 2&quot;)
       end;
Thread-id 3, task 1
Thread-id 1, task 2</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L473-L493">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.wait" href="#Base.wait"><code>Base.wait</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><a href="parallel.html#Base.Threads.Condition"><code>Threads.Condition</code></a> に関する特別な注意：</p><p>呼び出し元は、このメソッドを呼び出す前に <code>Threads.Condition</code> を所有する <a href="parallel.html#Base.lock"><code>lock</code></a> を保持している必要があります。呼び出しタスクは、通常は同じ <code>Threads.Condition</code> オブジェクトで <a href="parallel.html#Base.notify"><code>notify</code></a> を呼び出すことによって他のタスクがそれを起こすまでブロックされます。ブロック中にロックは原子的に解放され（再帰的にロックされていた場合でも）、戻る前に再取得されます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L381-L389">source</a></section><section><div><pre><code class="language-julia hljs">wait(r::Future)</code></pre><p>指定された <a href="../stdlib/Future.html#Future"><code>Future</code></a> の値が利用可能になるまで待機します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/Distributed.jl/blob/6c7cdb5860fa5cb9ca191ce9c52a3d25a9ab3781/src/remotecall.jl#L581-L585">source</a></section><section><div><pre><code class="language-julia hljs">wait(r::RemoteChannel, args...)</code></pre><p>指定された <a href="../stdlib/Distributed.html#Distributed.RemoteChannel"><code>RemoteChannel</code></a> で値が利用可能になるまで待機します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/Distributed.jl/blob/6c7cdb5860fa5cb9ca191ce9c52a3d25a9ab3781/src/remotecall.jl#L588-L592">source</a></section><section><div><pre><code class="language-julia hljs">wait([x])</code></pre><p>現在のタスクを、引数のタイプに応じて何らかのイベントが発生するまでブロックします：</p><ul><li><a href="parallel.html#Base.Channel"><code>Channel</code></a>: チャンネルに値が追加されるのを待ちます。</li><li><a href="parallel.html#Base.Condition"><code>Condition</code></a>: 条件で<a href="parallel.html#Base.notify"><code>notify</code></a>が呼ばれるのを待ち、<code>notify</code>に渡された<code>val</code>パラメータを返します。条件で待機することは、<code>first=true</code>を渡すことも可能で、これにより待機者は通常の先入れ先出しの動作の代わりに<code>notify</code>で起こされるための<em>最初</em>の位置に置かれます。</li><li><code>Process</code>: プロセスまたはプロセスチェーンが終了するのを待ちます。プロセスの<code>exitcode</code>フィールドを使用して成功または失敗を判断できます。</li><li><a href="parallel.html#Core.Task"><code>Task</code></a>: <code>Task</code>が終了するのを待ちます。タスクが例外で失敗した場合、失敗したタスクをラップした<code>TaskFailedException</code>がスローされます。</li><li><a href="file.html#Base.Libc.RawFD"><code>RawFD</code></a>: ファイルディスクリプタの変更を待ちます（<code>FileWatching</code>パッケージを参照）。</li></ul><p>引数が渡されない場合、タスクは未定義の期間ブロックされます。タスクは、<a href="parallel.html#Base.schedule"><code>schedule</code></a>または<a href="parallel.html#Base.yieldto"><code>yieldto</code></a>への明示的な呼び出しによってのみ再起動できます。</p><p>しばしば<code>wait</code>は<code>while</code>ループ内で呼び出され、進行する前に待機している条件が満たされることを確認します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/condition.jl#L103-L124">source</a></section><section><div><pre><code class="language-julia hljs">wait(c::Channel)</code></pre><p><code>Channel</code> <a href="parallel.html#Base.isready-Tuple{Channel}"><code>isready</code></a> までブロックします。</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(1);

julia&gt; isready(c)
false

julia&gt; task = Task(() -&gt; wait(c));

julia&gt; schedule(task);

julia&gt; istaskdone(task)  # タスクはチャネルが準備できていないためブロックされています
false

julia&gt; put!(c, 1);

julia&gt; istaskdone(task)  # タスクは今やブロック解除されました
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L567-L590">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.fetch-Tuple{Task}" href="#Base.fetch-Tuple{Task}"><code>Base.fetch</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fetch(t::Task)</code></pre><p><a href="parallel.html#Core.Task"><code>Task</code></a> が完了するのを待ってから、その結果の値を返します。タスクが例外で失敗した場合、失敗したタスクをラップした <a href="base.html#Base.TaskFailedException"><code>TaskFailedException</code></a> がスローされます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L382-L388">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.fetch-Tuple{Any}" href="#Base.fetch-Tuple{Any}"><code>Base.fetch</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fetch(x::Any)</code></pre><p><code>x</code>を返します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/task.jl#L375-L379">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.timedwait" href="#Base.timedwait"><code>Base.timedwait</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">timedwait(testcb, timeout::Real; pollint::Real=0.1)</code></pre><p><code>testcb()</code> が <code>true</code> を返すか、<code>timeout</code> 秒が経過するまで待機します。どちらか早い方が優先されます。テスト関数は毎 <code>pollint</code> 秒ごとにポーリングされます。<code>pollint</code> の最小値は 0.001 秒、すなわち 1 ミリ秒です。</p><p><code>:ok</code> または <code>:timed_out</code> を返します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; cb() = (sleep(5); return);

julia&gt; t = @async cb();

julia&gt; timedwait(()-&gt;istaskdone(t), 1)
:timed_out

julia&gt; timedwait(()-&gt;istaskdone(t), 6.5)
:ok</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/asyncevent.jl#L334-L355">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Condition" href="#Base.Condition"><code>Base.Condition</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Condition()</code></pre><p>タスクが待機できるエッジトリガーイベントソースを作成します。<code>Condition</code>上で<a href="parallel.html#Base.wait"><code>wait</code></a>を呼び出すタスクは、一時停止され、キューに入れられます。後で<code>Condition</code>上で<a href="parallel.html#Base.notify"><code>notify</code></a>が呼び出されると、タスクは起こされます。条件で待機することは、値を返すか、<a href="parallel.html#Base.notify"><code>notify</code></a>のオプション引数が使用されている場合にエラーを発生させることがあります。エッジトリガーは、<a href="parallel.html#Base.notify"><code>notify</code></a>が呼び出された時点で待機しているタスクのみが起こされることを意味します。レベルトリガー通知の場合、通知が発生したかどうかを追跡するために追加の状態を保持する必要があります。<a href="parallel.html#Base.Channel"><code>Channel</code></a>および<a href="parallel.html#Base.Event"><code>Threads.Event</code></a>タイプはこれを行い、レベルトリガーイベントに使用できます。</p><p>このオブジェクトはスレッドセーフではありません。スレッドセーフなバージョンについては、<a href="parallel.html#Base.Threads.Condition"><code>Threads.Condition</code></a>を参照してください。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/condition.jl#L173-L185">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Threads.Condition" href="#Base.Threads.Condition"><code>Base.Threads.Condition</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Threads.Condition([lock])</code></pre><p><a href="parallel.html#Base.Condition"><code>Base.Condition</code></a> のスレッドセーフなバージョンです。</p><p><code>Threads.Condition</code> で <a href="parallel.html#Base.wait"><code>wait</code></a> または <a href="parallel.html#Base.notify"><code>notify</code></a> を呼び出すには、まずそれに対して <a href="parallel.html#Base.lock"><code>lock</code></a> を呼び出す必要があります。<code>wait</code> が呼び出されると、ロックはブロッキング中に原子的に解放され、<code>wait</code> が戻る前に再取得されます。したがって、<code>Threads.Condition</code> <code>c</code> の慣用的な使用法は次のようになります。</p><pre><code class="nohighlight hljs">lock(c)
try
    while !thing_we_are_waiting_for
        wait(c)
    end
finally
    unlock(c)
end</code></pre><div class="admonition is-compat" id="Julia-1.2-5146f98810122d5e"><header class="admonition-header">Julia 1.2<a class="admonition-anchor" href="#Julia-1.2-5146f98810122d5e" title="Permalink"></a></header><div class="admonition-body"><p>この機能は少なくとも Julia 1.2 が必要です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L355-L378">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Event" href="#Base.Event"><code>Base.Event</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Event([autoreset=false])</code></pre><p>レベルトリガーイベントソースを作成します。<code>Event</code>上で<a href="parallel.html#Base.wait"><code>wait</code></a>を呼び出すタスクは、<code>notify</code>が<code>Event</code>上で呼び出されるまで、一時停止してキューに入れられます。<code>notify</code>が呼び出されると、<code>Event</code>はシグナル状態のままとなり、<code>reset</code>が呼び出されるまで、タスクはそれを待っている間にブロックされなくなります。</p><p><code>autoreset</code>がtrueの場合、<code>notify</code>の呼び出しごとに、<code>wait</code>から解放されるタスクは最大で1つになります。</p><p>これは、notify/waitに対して取得と解放のメモリ順序を提供します。</p><div class="admonition is-compat" id="Julia-1.1-8b4296455e938c00"><header class="admonition-header">Julia 1.1<a class="admonition-anchor" href="#Julia-1.1-8b4296455e938c00" title="Permalink"></a></header><div class="admonition-body"><p>この機能は少なくともJulia 1.1が必要です。</p></div></div><div class="admonition is-compat" id="Julia-1.8-fb242374104a22cc"><header class="admonition-header">Julia 1.8<a class="admonition-anchor" href="#Julia-1.8-fb242374104a22cc" title="Permalink"></a></header><div class="admonition-body"><p><code>autoreset</code>機能とメモリ順序の保証には、少なくともJulia 1.8が必要です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L481-L499">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.notify" href="#Base.notify"><code>Base.notify</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">notify(condition, val=nothing; all=true, error=false)</code></pre><p>条件を待っているタスクを起こし、<code>val</code>を渡します。<code>all</code>が<code>true</code>（デフォルト）であれば、すべての待機中のタスクが起こされ、そうでなければ1つだけが起こされます。<code>error</code>が<code>true</code>であれば、渡された値が起こされたタスクで例外として発生します。</p><p>起こされたタスクの数を返します。<code>condition</code>で待機中のタスクがない場合は0を返します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/condition.jl#L139-L147">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.reset-Tuple{Base.Event}" href="#Base.reset-Tuple{Base.Event}"><code>Base.reset</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">reset(::Event)</code></pre><p><a href="parallel.html#Base.Event"><code>Event</code></a> を未設定の状態にリセットします。その後、<code>wait</code> への将来の呼び出しは、再度 <a href="parallel.html#Base.notify"><code>notify</code></a> が呼び出されるまでブロックされます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L544-L549">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Semaphore" href="#Base.Semaphore"><code>Base.Semaphore</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Semaphore(sem_size)</code></pre><p>カウントセマフォを作成し、同時に使用できるのは最大で <code>sem_size</code> の取得のみを許可します。各取得は解放と対になっている必要があります。</p><p>これにより、取得/解放呼び出しに対して取得と解放のメモリ順序が提供されます。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L393-L401">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.acquire" href="#Base.acquire"><code>Base.acquire</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">acquire(s::Semaphore)</code></pre><p><code>sem_size</code> の許可のいずれかが利用可能になるのを待ち、取得できるまでブロックします。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L409-L414">source</a></section><section><div><pre><code class="language-julia hljs">acquire(f, s::Semaphore)</code></pre><p>Semaphore <code>s</code> から取得した後に <code>f</code> を実行し、完了またはエラー時に <code>release</code> します。</p><p>例えば、同時に <code>foo</code> の呼び出しが2回だけアクティブになることを保証する do-block 形式は次の通りです：</p><pre><code class="language-julia hljs">s = Base.Semaphore(2)
@sync for _ in 1:100
    Threads.@spawn begin
        Base.acquire(s) do
            foo()
        end
    end
end</code></pre><div class="admonition is-compat" id="Julia-1.8-5b6aec94bb6f8248"><header class="admonition-header">Julia 1.8<a class="admonition-anchor" href="#Julia-1.8-5b6aec94bb6f8248" title="Permalink"></a></header><div class="admonition-body"><p>このメソッドは少なくとも Julia 1.8 を必要とします。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L428-L451">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.release" href="#Base.release"><code>Base.release</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">release(s::Semaphore)</code></pre><p>プールに1つの許可を返し、別のタスクがそれを取得して実行を再開できるようにする可能性があります。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L461-L467">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.AbstractLock" href="#Base.AbstractLock"><code>Base.AbstractLock</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractLock</code></pre><p>同期プリミティブを実装するタイプを記述する抽象スーパタイプ: <a href="parallel.html#Base.lock"><code>lock</code></a>, <a href="parallel.html#Base.trylock"><code>trylock</code></a>, <a href="parallel.html#Base.unlock"><code>unlock</code></a>, および <a href="parallel.html#Base.islocked"><code>islocked</code></a>。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/condition.jl#L11-L17">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.lock" href="#Base.lock"><code>Base.lock</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lock(lock)</code></pre><p><code>lock</code>が利用可能になるときに取得します。ロックが別のタスク/スレッドによってすでにロックされている場合は、利用可能になるまで待ちます。</p><p>各<code>lock</code>は<a href="parallel.html#Base.unlock"><code>unlock</code></a>で対応する必要があります。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L137-L145">source</a></section><section><div><pre><code class="language-julia hljs">lock(f::Function, lock)</code></pre><p><code>lock</code>を取得し、<code>lock</code>を保持した状態で<code>f</code>を実行し、<code>f</code>が返るときに<code>lock</code>を解放します。ロックが別のタスク/スレッドによってすでにロックされている場合は、それが利用可能になるまで待機します。</p><p>この関数が返るとき、<code>lock</code>は解放されているため、呼び出し元はそれを<code>unlock</code>しようとしないでください。</p><p>参照: <a href="parallel.html#Base.@lock"><code>@lock</code></a>.</p><div class="admonition is-compat" id="Julia-1.7-124819851c21e8b5"><header class="admonition-header">Julia 1.7<a class="admonition-anchor" href="#Julia-1.7-124819851c21e8b5" title="Permalink"></a></header><div class="admonition-body"><p>第二引数として<a href="parallel.html#Base.Channel"><code>Channel</code></a>を使用するには、Julia 1.7以降が必要です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L214-L228">source</a></section><section><div><p>lock(f::Function, l::Lockable)</p><p><code>l</code>に関連付けられたロックを取得し、ロックを保持した状態で<code>f</code>を実行し、<code>f</code>が返るとロックを解放します。<code>f</code>は1つの位置引数を受け取ります：<code>l</code>によってラップされた値です。ロックが別のタスク/スレッドによってすでにロックされている場合は、それが利用可能になるまで待機します。この関数が返ると、<code>lock</code>は解放されているため、呼び出し元はそれを<code>unlock</code>しようとすべきではありません。</p><div class="admonition is-compat" id="Julia-1.11-dcc3b12636970f8d"><header class="admonition-header">Julia 1.11<a class="admonition-anchor" href="#Julia-1.11-dcc3b12636970f8d" title="Permalink"></a></header><div class="admonition-body"><p>Julia 1.11以上が必要です。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L330-L342">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.unlock" href="#Base.unlock"><code>Base.unlock</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">unlock(lock)</code></pre><p><code>lock</code>の所有権を解放します。</p><p>これは以前に取得された再帰的ロックである場合、内部カウンタを減少させてすぐに戻ります。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L167-L174">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.trylock" href="#Base.trylock"><code>Base.trylock</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">trylock(lock) -&gt; Success (Boolean)</code></pre><p>ロックが利用可能な場合はロックを取得し、成功した場合は <code>true</code> を返します。ロックがすでに別のタスク/スレッドによってロックされている場合は <code>false</code> を返します。</p><p>各成功した <code>trylock</code> は <a href="parallel.html#Base.unlock"><code>unlock</code></a> によって対応する必要があります。</p><p>関数 <code>trylock</code> は <a href="parallel.html#Base.islocked"><code>islocked</code></a> と組み合わせて、<em>ロックの <code>typeof(lock)</code> がサポートされている場合</em> にテスト・テスト・セットまたは指数バックオフアルゴリズムを書くために使用できます（そのドキュメントを参照してください）。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L97-L110">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.islocked" href="#Base.islocked"><code>Base.islocked</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">islocked(lock) -&gt; ステータス (ブール値)</code></pre><p><code>lock</code>が任意のタスク/スレッドによって保持されているかどうかを確認します。この関数単独では同期に使用すべきではありません。しかし、<code>islocked</code>を<a href="parallel.html#Base.trylock"><code>trylock</code></a>と組み合わせることで、<em><code>typeof(lock)</code>がサポートしている場合</em>にテスト・アンド・テスト・アンド・セットや指数バックオフアルゴリズムを書くために使用できます（そのドキュメントを参照してください）。</p><p><strong>拡張ヘルプ</strong></p><p>例えば、以下のように指数バックオフを実装することができます。<code>lock</code>の実装が以下に記載された特性を満たしている場合です。</p><pre><code class="language-julia hljs">nspins = 0
while true
    while islocked(lock)
        GC.safepoint()
        nspins += 1
        nspins &gt; LIMIT &amp;&amp; error(&quot;タイムアウト&quot;)
    end
    trylock(lock) &amp;&amp; break
    backoff()
end</code></pre><p><strong>実装</strong></p><p>ロックの実装は、以下の特性を持つ<code>islocked</code>を定義し、そのことをドキュメントに記載することを推奨します。</p><ul><li><code>islocked(lock)</code>はデータ競合がありません。</li><li><code>islocked(lock)</code>が<code>false</code>を返す場合、他のタスクからの干渉がなければ、<code>trylock(lock)</code>の即時呼び出しは成功しなければなりません（<code>true</code>を返します）。</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L54-L88">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.ReentrantLock" href="#Base.ReentrantLock"><code>Base.ReentrantLock</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">ReentrantLock()</code></pre><p>再入ロックを作成して、<a href="parallel.html#Core.Task"><code>Task</code></a>sを同期させます。同じタスクは必要な回数だけロックを取得できます（これが名前の「再入可能」という部分を意味します）。各<a href="parallel.html#Base.lock"><code>lock</code></a>は<a href="parallel.html#Base.unlock"><code>unlock</code></a>と対になっている必要があります。</p><p><code>lock</code>を呼び出すと、そのスレッドでのファイナライザの実行が対応する<code>unlock</code>まで抑制されます。以下に示す標準的なロックパターンの使用は自然にサポートされるべきですが、try/lockの順序を逆にしたり、tryブロックを完全に欠落させたりすることには注意してください（例えば、ロックを保持したまま戻ろうとすること）。</p><p>これは、ロック/アンロック呼び出しに対して取得/解放のメモリ順序を提供します。</p><pre><code class="nohighlight hljs">lock(l)
try
    &lt;atomic work&gt;
finally
    unlock(l)
end</code></pre><p><a href="parallel.html#Base.islocked"><code>!islocked(lck::ReentrantLock)</code></a>が成り立つ場合、<a href="parallel.html#Base.trylock"><code>trylock(lck)</code></a>は、他のタスクが「同時に」ロックを保持しようとしていない限り成功します。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L6-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.@lock" href="#Base.@lock"><code>Base.@lock</code></a> — <span class="docstring-category">Macro</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">@lock l expr</code></pre><p><code>lock(f, l::AbstractLock)</code>のマクロ版ですが、<code>f</code>関数の代わりに<code>expr</code>を使用します。次のように展開されます：</p><pre><code class="language-julia hljs">lock(l)
try
    expr
finally
    unlock(l)
end</code></pre><p>これは、<code>do</code>ブロックを使用した<a href="parallel.html#Base.lock"><code>lock</code></a>と似ていますが、クロージャを作成せず、したがってパフォーマンスを向上させることができます。</p><div class="admonition is-compat" id="Compat-66895d5161908217"><header class="admonition-header">Compat<a class="admonition-anchor" href="#Compat-66895d5161908217" title="Permalink"></a></header><div class="admonition-body"><p><code>@lock</code>はJulia 1.3で追加され、Julia 1.10でエクスポートされました。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L249-L267">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Lockable" href="#Base.Lockable"><code>Base.Lockable</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><p><code>Lockable(value, lock = ReentrantLock())</code></p><p><code>value</code>をラップし、提供された<code>lock</code>に関連付けられた<code>Lockable</code>オブジェクトを作成します。このオブジェクトは<a href="parallel.html#Base.@lock"><code>@lock</code></a>、<a href="parallel.html#Base.lock"><code>lock</code></a>、<a href="parallel.html#Base.trylock"><code>trylock</code></a>、<a href="parallel.html#Base.unlock"><code>unlock</code></a>をサポートします。値にアクセスするには、ロックを保持しながらロック可能オブジェクトのインデックスを指定します。</p><div class="admonition is-compat" id="Julia-1.11-dcc3b12636970f8d"><header class="admonition-header">Julia 1.11<a class="admonition-anchor" href="#Julia-1.11-dcc3b12636970f8d" title="Permalink"></a></header><div class="admonition-body"><p>Julia 1.11以上が必要です。</p></div></div><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; locked_list = Base.Lockable(Int[]);

julia&gt; @lock(locked_list, push!(locked_list[], 1)) # 値にアクセスするにはロックを保持する必要があります
1-element Vector{Int64}:
 1

julia&gt; lock(summary, locked_list)
&quot;1-element Vector{Int64}&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/lock.jl#L297-L321">source</a></section></article><h2 id="Channels"><a class="docs-heading-anchor" href="#Channels">Channels</a><a id="Channels-1"></a><a class="docs-heading-anchor-permalink" href="#Channels" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.AbstractChannel" href="#Base.AbstractChannel"><code>Base.AbstractChannel</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">AbstractChannel{T}</code></pre><p>型 <code>T</code> のオブジェクトを渡すチャネルの表現。</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L3-L7">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Channel" href="#Base.Channel"><code>Base.Channel</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Channel{T=Any}(size::Int=0)</code></pre><p><code>T</code>型の最大<code>size</code>個のオブジェクトを保持できる内部バッファを持つ<code>Channel</code>を構築します。 <a href="parallel.html#Base.put!-Tuple{Channel, Any}"><code>put!</code></a>が満杯のチャネルで呼び出されると、<a href="io-network.html#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a>でオブジェクトが削除されるまでブロックします。</p><p><code>Channel(0)</code>はバッファなしのチャネルを構築します。<code>put!</code>は対応する<code>take!</code>が呼ばれるまでブロックします。そしてその逆も同様です。</p><p>他のコンストラクタ:</p><ul><li><code>Channel()</code>: デフォルトコンストラクタで、<code>Channel{Any}(0)</code>と同等です。</li><li><code>Channel(Inf)</code>: <code>Channel{Any}(typemax(Int))</code>と同等です。</li><li><code>Channel(sz)</code>: <code>Channel{Any}(sz)</code>と同等です。</li></ul><div class="admonition is-compat" id="Julia-1.3-4fd6400d90ebee1e"><header class="admonition-header">Julia 1.3<a class="admonition-anchor" href="#Julia-1.3-4fd6400d90ebee1e" title="Permalink"></a></header><div class="admonition-body"><p>デフォルトコンストラクタ<code>Channel()</code>とデフォルト<code>size=0</code>はJulia 1.3で追加されました。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L13-L31">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.Channel-Tuple{Function}" href="#Base.Channel-Tuple{Function}"><code>Base.Channel</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">Channel{T=Any}(func::Function, size=0; taskref=nothing, spawn=false, threadpool=nothing)</code></pre><p><code>func</code>から新しいタスクを作成し、それを型<code>T</code>およびサイズ<code>size</code>の新しいチャネルにバインドし、タスクをスケジュールします。すべてが1回の呼び出しで行われます。タスクが終了すると、チャネルは自動的に閉じられます。</p><p><code>func</code>は、バインドされたチャネルを唯一の引数として受け入れる必要があります。</p><p>作成されたタスクへの参照が必要な場合は、キーワード引数<code>taskref</code>を介して<code>Ref{Task}</code>オブジェクトを渡してください。</p><p><code>spawn=true</code>の場合、<code>func</code>のために作成された<code>Task</code>は、別のスレッドで並行してスケジュールされる可能性があり、これは<a href="multi-threading.html#Base.Threads.@spawn"><code>Threads.@spawn</code></a>を介してタスクを作成することに相当します。</p><p><code>spawn=true</code>で<code>threadpool</code>引数が設定されていない場合、デフォルトは<code>:default</code>です。</p><p><code>threadpool</code>引数が設定されている場合（<code>:default</code>または<code>:interactive</code>）、これは<code>spawn=true</code>を意味し、新しいタスクは指定されたスレッドプールにスパーンされます。</p><p><code>Channel</code>を返します。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; chnl = Channel() do ch
           foreach(i -&gt; put!(ch, i), 1:4)
       end;

julia&gt; typeof(chnl)
Channel{Any}

julia&gt; for i in chnl
           @show i
       end;
i = 1
i = 2
i = 3
i = 4</code></pre><p>作成されたタスクを参照する：</p><pre><code class="language-julia-repl hljs">julia&gt; taskref = Ref{Task}();

julia&gt; chnl = Channel(taskref=taskref) do ch
           println(take!(ch))
       end;

julia&gt; istaskdone(taskref[])
false

julia&gt; put!(chnl, &quot;Hello&quot;);
Hello

julia&gt; istaskdone(taskref[])
true</code></pre><div class="admonition is-compat" id="Julia-1.3-8c5c0fba467d88ac"><header class="admonition-header">Julia 1.3<a class="admonition-anchor" href="#Julia-1.3-8c5c0fba467d88ac" title="Permalink"></a></header><div class="admonition-body"><p><code>spawn=</code>パラメータはJulia 1.3で追加されました。このコンストラクタはJulia 1.3で追加されました。以前のバージョンのJuliaでは、Channelはキーワード引数を使用して<code>size</code>と<code>T</code>を設定しましたが、それらのコンストラクタは非推奨です。</p></div></div><div class="admonition is-compat" id="Julia-1.9-a49271a0a69b69ac"><header class="admonition-header">Julia 1.9<a class="admonition-anchor" href="#Julia-1.9-a49271a0a69b69ac" title="Permalink"></a></header><div class="admonition-body"><p><code>threadpool=</code>引数はJulia 1.9で追加されました。</p></div></div><pre><code class="language-julia-repl hljs">julia&gt; chnl = Channel{Char}(1, spawn=true) do ch
           for c in &quot;hello world&quot;
               put!(ch, c)
           end
       end
Channel{Char}(1) (2 items available)

julia&gt; String(collect(chnl))
&quot;hello world&quot;</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L61-L139">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.put!-Tuple{Channel, Any}" href="#Base.put!-Tuple{Channel, Any}"><code>Base.put!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">put!(c::Channel, v)</code></pre><p>チャンネル <code>c</code> にアイテム <code>v</code> を追加します。チャンネルが満杯の場合はブロックします。</p><p>バッファなしのチャンネルの場合、別のタスクによって <a href="io-network.html#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> が実行されるまでブロックします。</p><div class="admonition is-compat" id="Julia-1.1-603c45492ab39e7e"><header class="admonition-header">Julia 1.1<a class="admonition-anchor" href="#Julia-1.1-603c45492ab39e7e" title="Permalink"></a></header><div class="admonition-body"><p><code>v</code> は、<code>put!</code> が呼び出されるときに <a href="base.html#Base.convert"><code>convert</code></a> を使ってチャンネルの型に変換されます。</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L344-L354">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.take!-Tuple{Channel}" href="#Base.take!-Tuple{Channel}"><code>Base.take!</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">take!(c::Channel)</code></pre><p><a href="parallel.html#Base.Channel"><code>Channel</code></a> から値を順番に削除して返します。データが利用可能になるまでブロックします。バッファなしのチャネルの場合、別のタスクによって <a href="parallel.html#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> が実行されるまでブロックします。</p><p><strong>例</strong></p><p>バッファ付きチャネル:</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(1);

julia&gt; put!(c, 1);

julia&gt; take!(c)
1</code></pre><p>バッファなしチャネル:</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(0);

julia&gt; task = Task(() -&gt; put!(c, 1));

julia&gt; schedule(task);

julia&gt; take!(c)
1</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L457-L486">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.isready-Tuple{Channel}" href="#Base.isready-Tuple{Channel}"><code>Base.isready</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">isready(c::Channel)</code></pre><p><a href="parallel.html#Base.Channel"><code>Channel</code></a> に値が格納されているかどうかを判断します。即座に返され、ブロックしません。</p><p>バッファなしのチャネルの場合、<a href="parallel.html#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> を待機しているタスクがある場合は <code>true</code> を返します。</p><p><strong>例</strong></p><p>バッファ付きチャネル:</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(1);

julia&gt; isready(c)
false

julia&gt; put!(c, 1);

julia&gt; isready(c)
true</code></pre><p>バッファなしチャネル:</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel();

julia&gt; isready(c)  # 値を入れるために待機しているタスクはありません!
false

julia&gt; task = Task(() -&gt; put!(c, 1));

julia&gt; schedule(task);  # put! タスクをスケジュールする

julia&gt; isready(c)
true</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L516-L554">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.fetch-Tuple{Channel}" href="#Base.fetch-Tuple{Channel}"><code>Base.fetch</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">fetch(c::Channel)</code></pre><p><code>Channel</code>から最初に利用可能なアイテムを待機して返します（削除せずに）。注意: <code>fetch</code>はバッファなし（サイズ0）の<code>Channel</code>ではサポートされていません。</p><p><strong>例</strong></p><p>バッファ付きチャネル:</p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(3) do ch
           foreach(i -&gt; put!(ch, i), 1:3)
       end;

julia&gt; fetch(c)
1

julia&gt; collect(c)  # アイテムは削除されません
3-element Vector{Any}:
 1
 2
 3</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L417-L440">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.close-Tuple{Channel}" href="#Base.close-Tuple{Channel}"><code>Base.close</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">close(c::Channel[, excp::Exception])</code></pre><p>チャネルを閉じます。例外（オプションで<code>excp</code>によって指定される）は、次の操作によってスローされます：</p><ul><li><a href="parallel.html#Base.put!-Tuple{Channel, Any}"><code>put!</code></a> が閉じたチャネルで呼び出されたとき。</li><li><a href="io-network.html#Base.take!-Tuple{Base.GenericIOBuffer}"><code>take!</code></a> および <a href="parallel.html#Base.fetch-Tuple{Task}"><code>fetch</code></a> が空の閉じたチャネルで呼び出されたとき。</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L192-L199">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="Base.bind-Tuple{Channel, Task}" href="#Base.bind-Tuple{Channel, Task}"><code>Base.bind</code></a> — <span class="docstring-category">Method</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">bind(chnl::Channel, task::Task)</code></pre><p><code>chnl</code>のライフタイムをタスクに関連付けます。タスクが終了すると、<code>Channel</code> <code>chnl</code>は自動的に閉じられます。タスク内で捕捉されない例外は、<code>chnl</code>のすべての待機者に伝播されます。</p><p><code>chnl</code>オブジェクトは、タスクの終了とは独立して明示的に閉じることができます。終了したタスクは、すでに閉じられた<code>Channel</code>オブジェクトには影響を与えません。</p><p>チャネルが複数のタスクにバインドされている場合、最初に終了したタスクがチャネルを閉じます。同じタスクに複数のチャネルがバインドされている場合、タスクの終了はすべてのバインドされたチャネルを閉じます。</p><p><strong>例</strong></p><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(0);

julia&gt; task = @async foreach(i-&gt;put!(c, i), 1:4);

julia&gt; bind(c,task);

julia&gt; for i in c
           @show i
       end;
i = 1
i = 2
i = 3
i = 4

julia&gt; isopen(c)
false</code></pre><pre><code class="language-julia-repl hljs">julia&gt; c = Channel(0);

julia&gt; task = @async (put!(c, 1); error(&quot;foo&quot;));

julia&gt; bind(c, task);

julia&gt; take!(c)
1

julia&gt; put!(c, 1);
ERROR: TaskFailedException
Stacktrace:
[...]
    nested task error: foo
[...]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/JuliaLang/julia/blob/760b2e5b7396f9cc0da5efce0cadd5d1974c4069/base/channels.jl#L237-L288">source</a></section></article><h2 id="low-level-schedule-wait"><a class="docs-heading-anchor" href="#low-level-schedule-wait">Low-level synchronization using <code>schedule</code> and <code>wait</code></a><a id="low-level-schedule-wait-1"></a><a class="docs-heading-anchor-permalink" href="#low-level-schedule-wait" title="Permalink"></a></h2><p><a href="parallel.html#Base.schedule"><code>schedule</code></a>の最も簡単な正しい使用法は、まだ開始されていない（スケジュールされた）<code>Task</code>上で行うことです。しかし、<code>4d61726b646f776e2e436f64652822222c20227363686564756c652229_40726566</code>と<a href="parallel.html#Base.wait"><code>wait</code></a>を、同期インターフェースを構築するための非常に低レベルのビルディングブロックとして使用することも可能です。<code>schedule(task)</code>を呼び出すための重要な前提条件は、呼び出し元が<code>task</code>を「所有」している必要があることです。つまり、与えられた<code>task</code>内の<code>wait</code>への呼び出しが、<code>schedule(task)</code>を呼び出すコードが知っている場所で行われていることを知っている必要があります。このような前提条件を確保するための戦略の一つは、以下の例に示すようにアトミックを使用することです。</p><pre><code class="language-julia hljs">@enum OWEState begin
    OWE_EMPTY
    OWE_WAITING
    OWE_NOTIFYING
end

mutable struct OneWayEvent
    @atomic state::OWEState
    task::Task
    OneWayEvent() = new(OWE_EMPTY)
end

function Base.notify(ev::OneWayEvent)
    state = @atomic ev.state
    while state !== OWE_NOTIFYING
        # Spin until we successfully update the state to OWE_NOTIFYING:
        state, ok = @atomicreplace(ev.state, state =&gt; OWE_NOTIFYING)
        if ok
            if state == OWE_WAITING
                # OWE_WAITING -&gt; OWE_NOTIFYING transition means that the waiter task is
                # already waiting or about to call `wait`. The notifier task must wake up
                # the waiter task.
                schedule(ev.task)
            else
                @assert state == OWE_EMPTY
                # Since we are assuming that there is only one notifier task (for
                # simplicity), we know that the other possible case here is OWE_EMPTY.
                # We do not need to do anything because we know that the waiter task has
                # not called `wait(ev::OneWayEvent)` yet.
            end
            break
        end
    end
    return
end

function Base.wait(ev::OneWayEvent)
    ev.task = current_task()
    state, ok = @atomicreplace(ev.state, OWE_EMPTY =&gt; OWE_WAITING)
    if ok
        # OWE_EMPTY -&gt; OWE_WAITING transition means that the notifier task is guaranteed to
        # invoke OWE_WAITING -&gt; OWE_NOTIFYING transition.  The waiter task must call
        # `wait()` immediately.  In particular, it MUST NOT invoke any function that may
        # yield to the scheduler at this point in code.
        wait()
    else
        @assert state == OWE_NOTIFYING
        # Otherwise, the `state` must have already been moved to OWE_NOTIFYING by the
        # notifier task.
    end
    return
end

ev = OneWayEvent()
@sync begin
    @async begin
        wait(ev)
        println(&quot;done&quot;)
    end
    println(&quot;notifying...&quot;)
    notify(ev)
end

# output
notifying...
done</code></pre><p><code>OneWayEvent</code>は、1つのタスクが別のタスクの<code>notify</code>を<code>wait</code>することを可能にします。これは、<code>wait</code>が単一のタスクから1回しか使用できないため、制限された通信インターフェースです（<code>ev.task</code>の非原子的な代入に注意してください）。</p><p>この例では、<code>notify(ev::OneWayEvent)</code>は、<em>それ</em>が状態を<code>OWE_WAITING</code>から<code>OWE_NOTIFYING</code>に変更する場合に限り、<code>schedule(ev.task)</code>を呼び出すことが許可されています。これにより、<code>wait(ev::OneWayEvent)</code>を実行しているタスクが現在<code>ok</code>ブランチにあり、他のタスクが<code>@atomicreplace(ev.state, state =&gt; OWE_NOTIFYING)</code>を失敗させるため、<code>schedule(ev.task)</code>を試みることができないことがわかります。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="arrays.html">« Arrays</a><a class="docs-footer-nextpage" href="multi-threading.html">Multi-Threading »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.11.4 on <span class="colophon-date" title="Tuesday 20 May 2025 07:07">Tuesday 20 May 2025</span>. Using Julia version 1.11.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
