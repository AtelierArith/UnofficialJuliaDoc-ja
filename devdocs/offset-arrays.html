<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Arrays with custom indices · The Julia Language</title><meta name="title" content="Arrays with custom indices · The Julia Language"/><meta property="og:title" content="Arrays with custom indices · The Julia Language"/><meta property="twitter:title" content="Arrays with custom indices · The Julia Language"/><meta name="description" content="Documentation for The Julia Language."/><meta property="og:description" content="Documentation for The Julia Language."/><meta property="twitter:description" content="Documentation for The Julia Language."/><script async src="https://www.googletagmanager.com/gtag/js?id=UA-28835595-6"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-28835595-6', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script><link href="../assets/julia-manual.css" rel="stylesheet" type="text/css"/><link href="../assets/julia.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../index.html"><img class="docs-light-only" src="../assets/logo.svg" alt="The Julia Language logo"/><img class="docs-dark-only" src="../assets/logo-dark.svg" alt="The Julia Language logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../index.html">Julia Documentation</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Manual</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../manual/getting-started.html">Getting Started</a></li><li><a class="tocitem" href="../manual/installation.html">Installation</a></li><li><a class="tocitem" href="../manual/variables.html">Variables</a></li><li><a class="tocitem" href="../manual/integers-and-floating-point-numbers.html">Integers and Floating-Point Numbers</a></li><li><a class="tocitem" href="../manual/mathematical-operations.html">Mathematical Operations and Elementary Functions</a></li><li><a class="tocitem" href="../manual/complex-and-rational-numbers.html">Complex and Rational Numbers</a></li><li><a class="tocitem" href="../manual/strings.html">Strings</a></li><li><a class="tocitem" href="../manual/functions.html">Functions</a></li><li><a class="tocitem" href="../manual/control-flow.html">Control Flow</a></li><li><a class="tocitem" href="../manual/variables-and-scoping.html">Scope of Variables</a></li><li><a class="tocitem" href="../manual/types.html">Types</a></li><li><a class="tocitem" href="../manual/methods.html">Methods</a></li><li><a class="tocitem" href="../manual/constructors.html">Constructors</a></li><li><a class="tocitem" href="../manual/conversion-and-promotion.html">Conversion and Promotion</a></li><li><a class="tocitem" href="../manual/interfaces.html">Interfaces</a></li><li><a class="tocitem" href="../manual/modules.html">Modules</a></li><li><a class="tocitem" href="../manual/documentation.html">Documentation</a></li><li><a class="tocitem" href="../manual/metaprogramming.html">Metaprogramming</a></li><li><a class="tocitem" href="../manual/arrays.html">Single- and multi-dimensional Arrays</a></li><li><a class="tocitem" href="../manual/missing.html">Missing Values</a></li><li><a class="tocitem" href="../manual/networking-and-streams.html">Networking and Streams</a></li><li><a class="tocitem" href="../manual/parallel-computing.html">Parallel Computing</a></li><li><a class="tocitem" href="../manual/asynchronous-programming.html">Asynchronous Programming</a></li><li><a class="tocitem" href="../manual/multi-threading.html">Multi-Threading</a></li><li><a class="tocitem" href="../manual/distributed-computing.html">Multi-processing and Distributed Computing</a></li><li><a class="tocitem" href="../manual/running-external-programs.html">Running External Programs</a></li><li><a class="tocitem" href="../manual/calling-c-and-fortran-code.html">Calling C and Fortran Code</a></li><li><a class="tocitem" href="../manual/handling-operating-system-variation.html">Handling Operating System Variation</a></li><li><a class="tocitem" href="../manual/environment-variables.html">Environment Variables</a></li><li><a class="tocitem" href="../manual/embedding.html">Embedding Julia</a></li><li><a class="tocitem" href="../manual/code-loading.html">Code Loading</a></li><li><a class="tocitem" href="../manual/profile.html">Profiling</a></li><li><a class="tocitem" href="../manual/stacktraces.html">Stack Traces</a></li><li><a class="tocitem" href="../manual/memory-management.html">Memory Management and Garbage Collection</a></li><li><a class="tocitem" href="../manual/performance-tips.html">Performance Tips</a></li><li><a class="tocitem" href="../manual/workflow-tips.html">Workflow Tips</a></li><li><a class="tocitem" href="../manual/style-guide.html">Style Guide</a></li><li><a class="tocitem" href="../manual/faq.html">Frequently Asked Questions</a></li><li><a class="tocitem" href="../manual/noteworthy-differences.html">Noteworthy Differences from other Languages</a></li><li><a class="tocitem" href="../manual/unicode-input.html">Unicode Input</a></li><li><a class="tocitem" href="../manual/command-line-interface.html">Command-line Interface</a></li><li><a class="tocitem" href="../manual/worldage.html">The World Age mechanism</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Base</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../base/base.html">Essentials</a></li><li><a class="tocitem" href="../base/collections.html">Collections and Data Structures</a></li><li><a class="tocitem" href="../base/math.html">Mathematics</a></li><li><a class="tocitem" href="../base/numbers.html">Numbers</a></li><li><a class="tocitem" href="../base/strings.html">Strings</a></li><li><a class="tocitem" href="../base/arrays.html">Arrays</a></li><li><a class="tocitem" href="../base/parallel.html">Tasks</a></li><li><a class="tocitem" href="../base/multi-threading.html">Multi-Threading</a></li><li><a class="tocitem" href="../base/scopedvalues.html">Scoped Values</a></li><li><a class="tocitem" href="../base/constants.html">Constants</a></li><li><a class="tocitem" href="../base/file.html">Filesystem</a></li><li><a class="tocitem" href="../base/io-network.html">I/O and Network</a></li><li><a class="tocitem" href="../base/punctuation.html">Punctuation</a></li><li><a class="tocitem" href="../base/sort.html">Sorting and Related Functions</a></li><li><a class="tocitem" href="../base/iterators.html">Iteration utilities</a></li><li><a class="tocitem" href="../base/reflection.html">Reflection and introspection</a></li><li><a class="tocitem" href="../base/c.html">C Interface</a></li><li><a class="tocitem" href="../base/libc.html">C Standard Library</a></li><li><a class="tocitem" href="../base/stacktraces.html">StackTraces</a></li><li><a class="tocitem" href="../base/simd-types.html">SIMD Support</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Standard Library</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../stdlib/ArgTools.html">ArgTools</a></li><li><a class="tocitem" href="../stdlib/Artifacts.html">Artifacts</a></li><li><a class="tocitem" href="../stdlib/Base64.html">Base64</a></li><li><a class="tocitem" href="../stdlib/CRC32c.html">CRC32c</a></li><li><a class="tocitem" href="../stdlib/Dates.html">Dates</a></li><li><a class="tocitem" href="../stdlib/DelimitedFiles.html">Delimited Files</a></li><li><a class="tocitem" href="../stdlib/Distributed.html">Distributed Computing</a></li><li><a class="tocitem" href="../stdlib/Downloads.html">Downloads</a></li><li><a class="tocitem" href="../stdlib/FileWatching.html">File Events</a></li><li><a class="tocitem" href="../stdlib/Future.html">Future</a></li><li><a class="tocitem" href="../stdlib/InteractiveUtils.html">Interactive Utilities</a></li><li><a class="tocitem" href="../stdlib/JuliaSyntaxHighlighting.html">Julia Syntax Highlighting</a></li><li><a class="tocitem" href="../stdlib/LazyArtifacts.html">Lazy Artifacts</a></li><li><a class="tocitem" href="../stdlib/LibCURL.html">LibCURL</a></li><li><a class="tocitem" href="../stdlib/LibGit2.html">LibGit2</a></li><li><a class="tocitem" href="../stdlib/Libdl.html">Dynamic Linker</a></li><li><a class="tocitem" href="../stdlib/LinearAlgebra.html">Linear Algebra</a></li><li><a class="tocitem" href="../stdlib/Logging.html">Logging</a></li><li><a class="tocitem" href="../stdlib/Markdown.html">Markdown</a></li><li><a class="tocitem" href="../stdlib/Mmap.html">Memory-mapped I/O</a></li><li><a class="tocitem" href="../stdlib/NetworkOptions.html">Network Options</a></li><li><a class="tocitem" href="../stdlib/Pkg.html">Pkg</a></li><li><a class="tocitem" href="../stdlib/Printf.html">Printf</a></li><li><a class="tocitem" href="../stdlib/Profile.html">Profiling</a></li><li><a class="tocitem" href="../stdlib/REPL.html">The Julia REPL</a></li><li><a class="tocitem" href="../stdlib/Random.html">Random Numbers</a></li><li><a class="tocitem" href="../stdlib/SHA.html">SHA</a></li><li><a class="tocitem" href="../stdlib/Serialization.html">Serialization</a></li><li><a class="tocitem" href="../stdlib/SharedArrays.html">Shared Arrays</a></li><li><a class="tocitem" href="../stdlib/Sockets.html">Sockets</a></li><li><a class="tocitem" href="../stdlib/SparseArrays.html">Sparse Arrays</a></li><li><a class="tocitem" href="../stdlib/Statistics.html">Statistics</a></li><li><a class="tocitem" href="../stdlib/StyledStrings.html">StyledStrings</a></li><li><a class="tocitem" href="../stdlib/TOML.html">TOML</a></li><li><a class="tocitem" href="../stdlib/Tar.html">Tar</a></li><li><a class="tocitem" href="../stdlib/Test.html">Unit Testing</a></li><li><a class="tocitem" href="../stdlib/UUIDs.html">UUIDs</a></li><li><a class="tocitem" href="../stdlib/Unicode.html">Unicode</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox" checked/><label class="tocitem" for="menuitem-6"><span class="docs-label">Developer Documentation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><input class="collapse-toggle" id="menuitem-6-1" type="checkbox" checked/><label class="tocitem" for="menuitem-6-1"><span class="docs-label">Documentation of Julia&#39;s Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="init.html">Initialization of the Julia runtime</a></li><li><a class="tocitem" href="ast.html">Julia ASTs</a></li><li><a class="tocitem" href="types.html">More about types</a></li><li><a class="tocitem" href="object.html">Memory layout of Julia Objects</a></li><li><a class="tocitem" href="eval.html">Eval of Julia code</a></li><li><a class="tocitem" href="callconv.html">Calling Conventions</a></li><li><a class="tocitem" href="compiler.html">High-level Overview of the Native-Code Generation Process</a></li><li><a class="tocitem" href="functions.html">Julia Functions</a></li><li><a class="tocitem" href="cartesian.html">Base.Cartesian</a></li><li><a class="tocitem" href="meta.html">Talking to the compiler (the <code>:meta</code> mechanism)</a></li><li><a class="tocitem" href="subarrays.html">SubArrays</a></li><li><a class="tocitem" href="isbitsunionarrays.html">isbits Union Optimizations</a></li><li><a class="tocitem" href="sysimg.html">System Image Building</a></li><li><a class="tocitem" href="pkgimg.html">Package Images</a></li><li><a class="tocitem" href="llvm-passes.html">Custom LLVM Passes</a></li><li><a class="tocitem" href="llvm.html">Working with LLVM</a></li><li><a class="tocitem" href="stdio.html">printf() and stdio in the Julia runtime</a></li><li><a class="tocitem" href="boundscheck.html">Bounds checking</a></li><li><a class="tocitem" href="locks.html">Proper maintenance and care of multi-threading locks</a></li><li class="is-active"><a class="tocitem" href="offset-arrays.html">Arrays with custom indices</a><ul class="internal"><li><a class="tocitem" href="#Generalizing-existing-code"><span>Generalizing existing code</span></a></li><li><a class="tocitem" href="#Writing-custom-array-types-with-non-1-indexing"><span>Writing custom array types with non-1 indexing</span></a></li></ul></li><li><a class="tocitem" href="require.html">Module loading</a></li><li><a class="tocitem" href="inference.html">Inference</a></li><li><a class="tocitem" href="ssair.html">Julia SSA-form IR</a></li><li><a class="tocitem" href="EscapeAnalysis.html"><code>EscapeAnalysis</code></a></li><li><a class="tocitem" href="aot.html">Ahead of Time Compilation</a></li><li><a class="tocitem" href="gc-sa.html">Static analyzer annotations for GC correctness in C code</a></li><li><a class="tocitem" href="gc.html">Garbage Collection in Julia</a></li><li><a class="tocitem" href="jit.html">JIT Design and Implementation</a></li><li><a class="tocitem" href="builtins.html">Core.Builtins</a></li><li><a class="tocitem" href="precompile_hang.html">Fixing precompilation hangs due to open tasks or IO</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Developing/debugging Julia&#39;s C code</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="backtraces.html">Reporting and analyzing crashes (segfaults)</a></li><li><a class="tocitem" href="debuggingtips.html">gdb debugging tips</a></li><li><a class="tocitem" href="valgrind.html">Using Valgrind with Julia</a></li><li><a class="tocitem" href="external_profilers.html">External Profiler Support</a></li><li><a class="tocitem" href="sanitizers.html">Sanitizer support</a></li><li><a class="tocitem" href="probes.html">Instrumenting Julia with DTrace, and bpftrace</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6-3" type="checkbox"/><label class="tocitem" for="menuitem-6-3"><span class="docs-label">Building Julia</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="build/build.html">Building Julia (Detailed)</a></li><li><a class="tocitem" href="build/linux.html">Linux</a></li><li><a class="tocitem" href="build/macos.html">macOS</a></li><li><a class="tocitem" href="build/windows.html">Windows</a></li><li><a class="tocitem" href="build/freebsd.html">FreeBSD</a></li><li><a class="tocitem" href="build/arm.html">ARM (Linux)</a></li><li><a class="tocitem" href="build/distributing.html">Binary distributions</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Developer Documentation</a></li><li><a class="is-disabled">Documentation of Julia&#39;s Internals</a></li><li class="is-active"><a href="offset-arrays.html">Arrays with custom indices</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="offset-arrays.html">Arrays with custom indices</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaLang/julia/blob/master/doc/src/devdocs/offset-arrays.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="man-custom-indices"><a class="docs-heading-anchor" href="#man-custom-indices">Arrays with custom indices</a><a id="man-custom-indices-1"></a><a class="docs-heading-anchor-permalink" href="#man-custom-indices" title="Permalink"></a></h1><p>従来、Juliaの配列は1からインデックスが始まりますが、他のいくつかの言語は0から番号を付け始め、さらに他の言語（例：Fortran）は任意の開始インデックスを指定することを許可しています。標準を選ぶことには多くの利点があります（つまり、Juliaの場合は1）。しかし、<code>1:size(A,d)</code>の範囲外でインデックスを付けることができると、かなり簡素化されるアルゴリズムもあります（<code>0:size(A,d)-1</code>だけではありません）。そのような計算を容易にするために、Juliaは任意のインデックスを持つ配列をサポートしています。</p><p>このページの目的は、「自分のコードでそのような配列をサポートするために何をしなければならないのか？」という質問に答えることです。まず、最も単純なケースに対処しましょう：もしあなたのコードが非慣習的なインデックスを持つ配列を扱う必要がないことが分かっているなら、答えは「何もしない」であることを願っています。従来の配列に対する古いコードは、Juliaのエクスポートされたインターフェースを使用している限り、基本的に変更なしで機能するはずです。インデックスが1から始まる従来の配列をユーザーに強制する方が便利だと感じる場合は、次のように追加できます。</p><pre><code class="language-julia hljs">Base.require_one_based_indexing(arrays...)</code></pre><p><code>arrays...</code> は、1-based インデックスを違反するものがないか確認したい配列オブジェクトのリストです。</p><h2 id="Generalizing-existing-code"><a class="docs-heading-anchor" href="#Generalizing-existing-code">Generalizing existing code</a><a id="Generalizing-existing-code-1"></a><a class="docs-heading-anchor-permalink" href="#Generalizing-existing-code" title="Permalink"></a></h2><p>概要として、手順は次のとおりです：</p><ul><li>Please provide the Markdown content or text that you would like me to translate into Japanese.</li><li><code>1:length(A)</code>を<code>eachindex(A)</code>に置き換えるか、場合によっては<code>LinearIndices(A)</code>に置き換えてください。</li><li>明示的な割り当てを <code>Array{Int}(undef, size(B))</code> のように置き換えて、 <code>similar(Array{Int}, axes(B))</code> を使用してください。</li></ul><p>これらは以下でより詳細に説明されています。</p><h3 id="Things-to-watch-out-for"><a class="docs-heading-anchor" href="#Things-to-watch-out-for">Things to watch out for</a><a id="Things-to-watch-out-for-1"></a><a class="docs-heading-anchor-permalink" href="#Things-to-watch-out-for" title="Permalink"></a></h3><p>なぜ非慣習的なインデックス付けが多くの人々の「すべての配列は1からインデックスが始まる」という仮定を壊すのか、常にそのような配列を使用することでエラーが発生する可能性があります。最も厄介なバグは、不正確な結果やセグメンテーションフォルト（Juliaの完全なクラッシュ）です。例えば、次の関数を考えてみましょう：</p><pre><code class="language-julia hljs">function mycopy!(dest::AbstractVector, src::AbstractVector)
    length(dest) == length(src) || throw(DimensionMismatch(&quot;vectors must match&quot;))
    # OK, now we&#39;re safe to use @inbounds, right? (not anymore!)
    for i = 1:length(src)
        @inbounds dest[i] = src[i]
    end
    dest
end</code></pre><p>このコードは、ベクトルが1からインデックス付けされていることを暗黙的に前提としています。もし <code>dest</code> が <code>src</code> とは異なるインデックスから始まる場合、このコードがセグメンテーションフォルトを引き起こす可能性があります。（もしセグメンテーションフォルトが発生した場合、原因を特定するために <code>--check-bounds=yes</code> オプションを使ってjuliaを実行してみてください。）</p><h3 id="Using-axes-for-bounds-checks-and-loop-iteration"><a class="docs-heading-anchor" href="#Using-axes-for-bounds-checks-and-loop-iteration">Using <code>axes</code> for bounds checks and loop iteration</a><a id="Using-axes-for-bounds-checks-and-loop-iteration-1"></a><a class="docs-heading-anchor-permalink" href="#Using-axes-for-bounds-checks-and-loop-iteration" title="Permalink"></a></h3><p><code>axes(A)</code>（<code>size(A)</code>を思い起こさせる）は、<code>A</code>の各次元に沿った有効なインデックスの範囲を指定する<code>AbstractUnitRange{&lt;:Integer}</code>オブジェクトのタプルを返します。<code>A</code>が非標準のインデックスを持つ場合、範囲は1から始まらないことがあります。特定の次元<code>d</code>の範囲だけが必要な場合は、<code>axes(A, d)</code>があります。</p><p>Baseはカスタム範囲タイプ<code>OneTo</code>を実装しており、<code>OneTo(n)</code>は<code>1:n</code>と同じ意味ですが、タイプシステムを通じて下限インデックスが1であることを保証する形式です。新しい<a href="../base/arrays.html#Core.AbstractArray"><code>AbstractArray</code></a>タイプに対して、これは<code>axes</code>によって返されるデフォルトであり、この配列タイプが「従来の」1ベースのインデックス付けを使用していることを示しています。</p><p>境界チェックのために、<code>checkbounds</code> と <code>checkindex</code> という専用の関数があり、これらは時々そのようなテストを簡素化することができます。</p><h3 id="Linear-indexing-(LinearIndices)"><a class="docs-heading-anchor" href="#Linear-indexing-(LinearIndices)">Linear indexing (<code>LinearIndices</code>)</a><a id="Linear-indexing-(LinearIndices)-1"></a><a class="docs-heading-anchor-permalink" href="#Linear-indexing-(LinearIndices)" title="Permalink"></a></h3><p>いくつかのアルゴリズムは、<code>A[i]</code>という単一の線形インデックスの形で最も便利（または効率的）に記述されますが、<code>A</code>が多次元であっても同様です。配列のネイティブインデックスに関係なく、線形インデックスは常に<code>1:length(A)</code>の範囲になります。しかし、これは一次元配列（いわゆる、<a href="../base/arrays.html#Base.AbstractVector"><code>AbstractVector</code></a>）に対して曖昧さを引き起こします：<code>v[i]</code>は線形インデックスを意味するのか、それとも配列のネイティブインデックスを用いたカートesianインデックスを意味するのか？</p><p>この理由から、最良の選択肢は <code>eachindex(A)</code> を使って配列を反復処理することか、またはインデックスを連続した整数にする必要がある場合は <code>LinearIndices(A)</code> を呼び出してインデックス範囲を取得することです。これにより、AがAbstractVectorである場合は <code>axes(A, 1)</code> が返され、それ以外の場合は <code>1:length(A)</code> の同等のものが返されます。</p><p>この定義によれば、1次元配列は常に配列のネイティブインデックスを使用したデカルトインデックスを使用します。これを強調するために、インデックス変換関数は、形状が非標準のインデックスを持つ1次元配列を示す場合（すなわち、<code>Tuple{UnitRange}</code>であり、<code>OneTo</code>のタプルではない場合）にエラーをスローすることに注意する価値があります。標準のインデックスを持つ配列の場合、これらの関数は従来通りに機能し続けます。</p><p><code>axes</code> と <code>LinearIndices</code> を使用して、<code>mycopy!</code> を次のように書き換えることができます:</p><pre><code class="language-julia hljs">function mycopy!(dest::AbstractVector, src::AbstractVector)
    axes(dest) == axes(src) || throw(DimensionMismatch(&quot;vectors must match&quot;))
    for i in LinearIndices(src)
        @inbounds dest[i] = src[i]
    end
    dest
end</code></pre><h3 id="Allocating-storage-using-generalizations-of-similar"><a class="docs-heading-anchor" href="#Allocating-storage-using-generalizations-of-similar">Allocating storage using generalizations of <code>similar</code></a><a id="Allocating-storage-using-generalizations-of-similar-1"></a><a class="docs-heading-anchor-permalink" href="#Allocating-storage-using-generalizations-of-similar" title="Permalink"></a></h3><p>ストレージは通常、<code>Array{Int}(undef, dims)</code> または <code>similar(A, args...)</code> を使用して割り当てられます。結果が他の配列のインデックスと一致する必要がある場合、これだけでは不十分なことがあります。そのようなパターンの一般的な置き換えは、<code>similar(storagetype, shape)</code> を使用することです。<code>storagetype</code> は、希望する基礎的な「従来の」動作の種類を示します。例えば、<code>Array{Int}</code> や <code>BitArray</code>、あるいは <code>dims-&gt;zeros(Float32, dims)</code>（これはすべてゼロの配列を割り当てます）などです。<code>shape</code> は、結果が使用するインデックスを指定する <a href="../base/numbers.html#Core.Integer"><code>Integer</code></a> または <code>AbstractUnitRange</code> の値のタプルです。Aのインデックスと一致するすべてゼロの配列を生成する便利な方法は、単に <code>zeros(A)</code> を使用することです。</p><p>いくつかの明示的な例を見ていきましょう。まず、<code>A</code>が従来のインデックスを持っている場合、<code>similar(Array{Int}, axes(A))</code>は<code>Array{Int}(undef, size(A))</code>を呼び出し、したがって配列を返します。<code>A</code>が従来でないインデックスを持つ<code>AbstractArray</code>型である場合、<code>similar(Array{Int}, axes(A))</code>は<code>Array{Int}</code>のように振る舞うものを返すべきですが、形状（インデックスを含む）が<code>A</code>に一致します。（最も明白な実装は、<code>Array{Int}(undef, size(A))</code>を割り当ててから、インデックスをシフトする型で「ラップ」することです。）</p><p><code>similar(Array{Int}, (axes(A, 2),))</code>は、<code>A</code>の列のインデックスに一致する<code>AbstractVector{Int}</code>（すなわち、1次元配列）を割り当てることにも注意してください。</p><h2 id="Writing-custom-array-types-with-non-1-indexing"><a class="docs-heading-anchor" href="#Writing-custom-array-types-with-non-1-indexing">Writing custom array types with non-1 indexing</a><a id="Writing-custom-array-types-with-non-1-indexing-1"></a><a class="docs-heading-anchor-permalink" href="#Writing-custom-array-types-with-non-1-indexing" title="Permalink"></a></h2><p>必要なメソッドのほとんどは、任意の <code>AbstractArray</code> タイプに対して標準的なものであり、<a href="../manual/interfaces.html#man-interface-array">Abstract Arrays</a> を参照してください。このページでは、非従来型のインデックス指定を定義するために必要な手順に焦点を当てています。</p><h3 id="Custom-AbstractUnitRange-types"><a class="docs-heading-anchor" href="#Custom-AbstractUnitRange-types">Custom <code>AbstractUnitRange</code> types</a><a id="Custom-AbstractUnitRange-types-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-AbstractUnitRange-types" title="Permalink"></a></h3><p>非1インデックス配列タイプを作成している場合、<code>axes</code>を特化させて<code>UnitRange</code>を返すようにするか、（おそらくより良い方法として）カスタムの<code>AbstractUnitRange</code>を返すようにしたいでしょう。カスタムタイプの利点は、<code>similar</code>のような関数に対するアロケーションタイプを「シグナル」することです。インデックスが0から始まる配列タイプを作成している場合、<code>ZeroRange</code>という新しい<code>AbstractUnitRange</code>を作成することから始めるのが望ましいでしょう。ここで、<code>ZeroRange(n)</code>は<code>0:n-1</code>に相当します。</p><p>一般的に、あなたのパッケージから <code>ZeroRange</code> をエクスポートしない方が良いでしょう。他のパッケージが独自の <code>ZeroRange</code> を実装している可能性があり、異なる <code>ZeroRange</code> タイプが複数存在することは（直感に反して）利点です：<code>ModuleA.ZeroRange</code> は <code>similar</code> が <code>ModuleA.ZeroArray</code> を作成すべきであることを示し、<code>ModuleB.ZeroRange</code> は <code>ModuleB.ZeroArray</code> タイプを示します。この設計により、多くの異なるカスタム配列タイプが平和的に共存できるようになります。</p><p>注意してください。Juliaパッケージ <a href="https://github.com/JuliaArrays/CustomUnitRanges.jl">CustomUnitRanges.jl</a> は、独自の <code>ZeroRange</code> タイプを書く必要を回避するために時々使用できます。</p><h3 id="Specializing-axes"><a class="docs-heading-anchor" href="#Specializing-axes">Specializing <code>axes</code></a><a id="Specializing-axes-1"></a><a class="docs-heading-anchor-permalink" href="#Specializing-axes" title="Permalink"></a></h3><p><code>AbstractUnitRange</code>型を持っている場合は、次に<code>axes</code>を特化させます:</p><pre><code class="language-julia hljs">Base.axes(A::ZeroArray) = map(n-&gt;ZeroRange(n), A.size)</code></pre><p>ここでは、<code>ZeroArray</code> に <code>size</code> というフィールドがあると想定しています（これを実装する他の方法もあります）。</p><p>場合によっては、<code>axes(A, d)</code>のフォールバック定義：</p><pre><code class="language-julia hljs">axes(A::AbstractArray{T,N}, d) where {T,N} = d &lt;= N ? axes(A)[d] : OneTo(1)</code></pre><p>あなたが望んでいるものではないかもしれません：<code>d &gt; ndims(A)</code> のときに <code>OneTo(1)</code> 以外のものを返すように特化する必要があるかもしれません。同様に、<code>Base</code> には <code>axes(A, 1)</code> と同等でありながら、<code>ndims(A) &gt; 0</code> であるかどうかを（実行時に）チェックすることを避ける専用の関数 <code>axes1</code> があります。（これは純粋にパフォーマンスの最適化です。）これは次のように定義されています：</p><pre><code class="language-julia hljs">axes1(A::AbstractArray{T,0}) where {T} = OneTo(1)
axes1(A::AbstractArray) = axes(A)[1]</code></pre><p>これらの最初のもの（ゼロ次元の場合）があなたのカスタム配列タイプにとって問題がある場合は、適切に特化させることを忘れないでください。</p><h3 id="Specializing-similar"><a class="docs-heading-anchor" href="#Specializing-similar">Specializing <code>similar</code></a><a id="Specializing-similar-1"></a><a class="docs-heading-anchor-permalink" href="#Specializing-similar" title="Permalink"></a></h3><p>あなたのカスタム <code>ZeroRange</code> タイプを考慮すると、次の2つの特殊化を <code>similar</code> に追加する必要があります:</p><pre><code class="language-julia hljs">function Base.similar(A::AbstractArray, T::Type, shape::Tuple{ZeroRange,Vararg{ZeroRange}})
    # body
end

function Base.similar(f::Union{Function,DataType}, shape::Tuple{ZeroRange,Vararg{ZeroRange}})
    # body
end</code></pre><p>これらの両方は、カスタム配列タイプを割り当てる必要があります。</p><h3 id="Specializing-reshape"><a class="docs-heading-anchor" href="#Specializing-reshape">Specializing <code>reshape</code></a><a id="Specializing-reshape-1"></a><a class="docs-heading-anchor-permalink" href="#Specializing-reshape" title="Permalink"></a></h3><p>オプションで、メソッドを定義します</p><pre><code class="nohighlight hljs">Base.reshape(A::AbstractArray, shape::Tuple{ZeroRange,Vararg{ZeroRange}}) = ...</code></pre><p>配列を<code>reshape</code>することで、結果にカスタムインデックスを持たせることができます。</p><h3 id="For-objects-that-mimic-AbstractArray-but-are-not-subtypes"><a class="docs-heading-anchor" href="#For-objects-that-mimic-AbstractArray-but-are-not-subtypes">For objects that mimic AbstractArray but are not subtypes</a><a id="For-objects-that-mimic-AbstractArray-but-are-not-subtypes-1"></a><a class="docs-heading-anchor-permalink" href="#For-objects-that-mimic-AbstractArray-but-are-not-subtypes" title="Permalink"></a></h3><p><code>has_offset_axes</code> は、呼び出すオブジェクトに <code>axes</code> が定義されていることに依存します。オブジェクトに <code>axes</code> メソッドが定義されていない理由がある場合は、メソッドを定義することを検討してください。</p><pre><code class="language-julia hljs">Base.has_offset_axes(obj::MyNon1IndexedArraylikeObject) = true</code></pre><p>これにより、1ベースのインデックスを前提とするコードが問題を検出し、有用なエラーをスローすることができるようになります。誤った結果を返したり、セグメンテーションフォルトを引き起こしたりすることはありません。</p><h3 id="Catching-errors"><a class="docs-heading-anchor" href="#Catching-errors">Catching errors</a><a id="Catching-errors-1"></a><a class="docs-heading-anchor-permalink" href="#Catching-errors" title="Permalink"></a></h3><p>新しい配列タイプが他のコードでエラーを引き起こす場合、役立つデバッグ手順の一つは、<code>getindex</code> と <code>setindex!</code> の実装で <code>@boundscheck</code> をコメントアウトすることです。これにより、すべての要素アクセスが境界をチェックします。または、<code>--check-bounds=yes</code> でジュリアを再起動します。</p><p>場合によっては、新しい配列タイプの <code>size</code> と <code>length</code> を一時的に無効にすることが役立つことがあります。なぜなら、誤った仮定をするコードがこれらの関数を頻繁に使用するからです。</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="locks.html">« Proper maintenance and care of multi-threading locks</a><a class="docs-footer-nextpage" href="require.html">Module loading »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Sunday 19 October 2025 04:54">Sunday 19 October 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
